{% extends "base.html" %}
{% block extra_title %} | {{ post.title }}{% endblock %}
{% block extra_head %}
<script src="http://maps.google.com/maps/api/js?sensor=false"></script>
<script>
    {% if post.location %}
  function initialize() {
    var latlng = new google.maps.LatLng({{ post.location.latitude }}, {{ post.location.longitude }});
    var myOptions = {
      zoom: 4,
      center: latlng,
      mapTypeId: google.maps.MapTypeId.ROADMAP
    };
    var map = new google.maps.Map(document.getElementById("map"),
        myOptions);

      var bounds = new google.maps.LatLngBounds();

      
      
      var latlng{{ post.location.id }} = new google.maps.LatLng({{ post.location.latitude }}, {{ post.location.longitude }});
      var marker{{ post.location.id }} = new google.maps.Marker({
         position: latlng{{ post.location.id }},
         map: map,
         title: ""
      });

      var content{{ post.location.id }} = '<div id="content">'+
          '<h3>{{ post.location }}</h3>' +
          
          '<p></p>' +
          
          '</div>';
      var infowindow{{ post.location.id }} = new google.maps.InfoWindow({
          content: content{{ post.location.id }}
      });
      google.maps.event.addListener(marker{{ post.location.id }}, 'click', function() {
         infowindow{{ post.location.id }}.open(map, marker{{ post.location.id }});
      });

      //bounds.extend(latlng{{ post.location.id }})
      {% endif %}

      //map.fitBounds(bounds);
  }
</script>
{% if post.fotochest_api_call %}
<script>
    
$(document).ready(function () {


$.ajax({
    url: "{{ post.fotochest_api_call }}",
    dataType: 'jsonp',
    success: function(data){
	$.each(data.objects, function(i,item){
    $("<a href='http://fotochest.com" + item.absolute_url + "'><img src='" + item.thumb + "' style='background: #000; padding:5px; margin-right:12px; margin-top:7px; width:220px'/></a>").appendTo("#photos")
      
  });		
    }
});

  });

  </script>
{% endif %}
{% endblock %}
{% block extra_body %} onLoad="initialize()"{% endblock %}

{% block main_content %}

        <article class="entry">
	    <h1><a href="{{ post.get_absolute_url }}">{{ post.title }}</a></h1>
	    <h2>Posted {{ post.published_date }} in <a href="{{ post.category.get_absolute_url }}">{{ post.category.name }}</a></h2>
            {% load thumbnail %}
    {% thumbnail post.image "783x221" crop="center" as im %}
    <img src="{{ im.url }}" class="trip_image">
    {% endthumbnail %}
            
            
            {% autoescape off %}
	{{ post.content }}
        {% endautoescape %}
        {% if post.fotochest_api_call %}
<section id="photos"></section>
{% endif %}
	<div id="map"></div>
        </article>
        

{% endblock %}

